(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{20:function(t,e,n){t.exports=n(42)},25:function(t,e,n){},37:function(t,e,n){},42:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),r=n(16),l=n.n(r),s=(n(25),n(4)),i=n(17),c=n(7),h=n(9),u=n(8),d=n(10),f=n(3),m=n(1),g=n.n(m),v=(n(37),n(18)),p=n.n(v),w=n(19),y=n.n(w),b=(a.Component,function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(h.a)(this,Object(u.a)(e).call(this,t))).fullStack=o.a.createRef(),n.fetchingPosts=!1,n.after=null,n.newPosts=[],n.POST_LIMIT=3,n.COMMENT_LIMIT=20,n.lastConfidence=0,n.fetchPosts=function(){n.state.posts.length>2||n.fetchingPosts||(n.fetchingPosts=!0,console.log("https://www.reddit.com/.json?limit="+n.POST_LIMIT+(null!==n.after?"&after=".concat(n.after):"")),fetch("https://www.reddit.com/.json?limit="+n.POST_LIMIT+(null!==n.after?"&after=".concat(n.after):"")).then(function(t){return t.json()}).then(function(t){var e=[];n.after=t.data.after,t.data.children&&t.data.children.map(function(t){return e.push(Promise.all([new Promise(function(e,a){fetch("https://www.reddit.com/"+t.data.permalink+"/.json?sort=controversial&limit="+n.COMMENT_LIMIT).then(function(t){return t.json()}).then(function(t){return e(t)}).catch(function(t){return a(t)})}),new Promise(function(e,a){fetch("https://www.reddit.com/"+t.data.permalink+"/.json?limit="+n.LIMIT).then(function(t){return t.json()}).then(function(t){return e(t)}).catch(function(t){return a(t)})})]))}),Promise.all(e).then(function(t){var e=n.parsePosts(t);n.newPosts=n.newPosts.concat(e.map(function(t){return t.id})),e=Object(s.a)(e).concat(Object(s.a)(n.state.posts)),n.setState({posts:e}),n.fetchingPosts=!1,n.fetchPosts()})}).catch(function(t){return console.log(t)}))},n.componentDidUpdate=function(){console.log(n.newPosts);var t=Object(s.a)(n.newPosts);n.newPosts=[];var e=!0,a=!1,o=void 0;try{for(var r,l=t[Symbol.iterator]();!(e=(r=l.next()).done);e=!0){var i=r.value,c=Object(s.a)(n.fullStack.current.children[1].children),h=!0,u=!1,d=void 0;try{for(var f,m=c[Symbol.iterator]();!(h=(f=m.next()).done);h=!0){var g=f.value;g.id===i&&(console.log("Stackifying element "+i),n.state.stack.createCard(g,!0))}}catch(v){u=!0,d=v}finally{try{h||null==m.return||m.return()}finally{if(u)throw d}}}}catch(v){a=!0,o=v}finally{try{e||null==l.return||l.return()}finally{if(a)throw o}}},n.parsePosts=function(t){if(!t)return[];var e=[],a=!0,o=!1,r=void 0;try{for(var l,s=t[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var i=l.value,c={},h=[],u=i[0];if(console.log(u),u&&u[0]&&u[0].data&&u[0].data.children[0]){var d=u[0].data.children[0].data,f=d.stickied,m=d.id,g=d.url,v=d.distinguished,p=d.thumbnail,w=d.title,y=null!=g.match(/\.(jpeg|png|gif|jpg)$/);if(f||"moderator"===v||!y||"self"===p)continue;c.title=w,c.id=m,c.imgUrl=g,c.num_comments=d.num_comments}if(u&&u[1]&&u[1].data&&u[1].data.children){var b=u[1].data.children;h=n.getComments(b,!0)}if((u=i[1])&&u[1]&&u[1].data&&u[1].data.children){var I=u[1].data.children;h=h.concat(n.getComments(I))}if(!(h.length<=0)){h=n.shuffle(h),c.comment=null;var E=!0,k=!1,T=void 0;try{for(var C,P=h[Symbol.iterator]();!(E=(C=P.next()).done);E=!0){var O=C.value;if(O.text&&O.text.split(" ").length<=14){c.comment=O;break}}}catch(j){k=!0,T=j}finally{try{E||null==P.return||P.return()}finally{if(k)throw T}}null!==c.comment&&e.push(c)}}}catch(j){o=!0,r=j}finally{try{a||null==s.return||s.return()}finally{if(o)throw r}}return e},n.handleClick=function(t,e){var a=n.state.posts;if(!(a.length<=0)){for(var o=a.length-1;o>=0;--o)if(a[o].id===t){var r=a[o].comment.contra&&e===g.a.DIRECTION.LEFT||!a[o].comment.contra&&e===g.a.DIRECTION.RIGHT;console.log("direction",e),console.log("left",e===g.a.DIRECTION.LEFT),console.log("right",e===g.a.DIRECTION.RIGHT);var l=n.state.best,s=n.state.score;r?s+=1:(s>l&&(l=s),s=0),n.setState({best:l,score:s}),a.splice(o,1)}n.setState({posts:a})}},n.dragEnd=function(t){if(console.log(t),!n.lastConfidence&&t.target&&t.target.attributes&&t.target.attributes.style){var e=t.target.attributes.style.textContent.match(/url\(["']([^"']+)/);e&&e.length>1&&y()(e[1],{},t.target)}},n.handleThrowEnd=function(t){console.log("elelelele",t),n.handleClick(t.target.id,t.throwDirection),n.fetchPosts()},n.getComments=function(t,e){var n=[],a=[],o=!0,r=!1,l=void 0;try{for(var s,i=t[Symbol.iterator]();!(o=(s=i.next()).done);o=!0){var c=s.value.data,h=c.stickied,u=c.body_html,d=c.body,f=c.id;h||(n.indexOf(f)>=0||(n.push(f),a.push({text:d,__html:p()(u),contra:e})))}}catch(m){r=!0,l=m}finally{try{o||null==i.return||i.return()}finally{if(r)throw l}}return a},n.shuffle=function(t){for(var e=t.length-1;e>0;e--){var n=Math.floor(Math.random()*(e+1)),a=[t[n],t[e]];t[e]=a[0],t[n]=a[1]}return t},n.state={posts:[],stack:null,best:0,score:0},n}return Object(d.a)(e,t),Object(i.a)(e,[{key:"componentDidMount",value:function(){this.fetchPosts()}},{key:"render",value:function(){var t=this;return o.a.createElement("div",{className:"App"},o.a.createElement("div",{ref:this.fullStack,id:"viewport"},o.a.createElement("p",{style:{paddingBottom:"3px"}},"Best: ",this.state.best," Score: ",this.state.score),o.a.createElement(g.a,{className:"stack",setStack:function(e){return t.setState({stack:e})},throwout:this.handleThrowEnd.bind(this),dragend:this.dragEnd.bind(this),config:{allowedDirections:[g.a.DIRECTION.LEFT,g.a.DIRECTION.RIGHT],throwOutConfidence:function(e,n,a){var o=Math.min(Math.abs(e)/a.offsetWidth/.5,1),r=Math.min(Math.abs(n)/a.offsetHeight,1);return t.lastConfidence=Math.max(o,r),t.lastConfidence}}},this.state.posts&&this.state.posts.map(function(t){return o.a.createElement("div",{className:"card",id:t.id,key:"render-".concat(t.id),"data-lity-target":t.imgUrl,"data-lity-desc":'" data-lity-close junk="',style:{background:'linear-gradient(to bottom,hsla(0, 0%, 0%, 0) 0%,hsla(0, 0%, 0%, 0.004) 18.7%,hsla(0, 0%, 0%, 0.015) 34.9%,hsla(0, 0%, 0%, 0.034) 48.7%,hsla(0, 0%, 0%, 0.06) 60.4%,hsla(0, 0%, 0%, 0.094) 70.1%,hsla(0, 0%, 0%, 0.135) 78.1%,hsla(0, 0%, 0%, 0.184) 84.5%,hsla(0, 0%, 0%, 0.241) 89.4%,hsla(0, 0%, 0%, 0.305) 93.2%,hsla(0, 0%, 0%, 0.377) 95.9%,hsla(0, 0%, 0%, 0.456) 97.7%,hsla(0, 0%, 0%, 0.543) 98.8%,hsla(0, 0%, 0%, 0.638) 99.5%,hsla(0, 0%, 0%, 0.74) 99.8%,hsla(0, 0%, 0%, 0.85) 100%),linear-gradient(to top,hsla(0, 0%, 0%, 0) 0%,hsla(0, 0%, 0%, 0.004) 18.7%,hsla(0, 0%, 0%, 0.015) 34.9%,hsla(0, 0%, 0%, 0.034) 48.7%,hsla(0, 0%, 0%, 0.06) 60.4%,hsla(0, 0%, 0%, 0.094) 70.1%,hsla(0, 0%, 0%, 0.135) 78.1%,hsla(0, 0%, 0%, 0.184) 84.5%,hsla(0, 0%, 0%, 0.241) 89.4%,hsla(0, 0%, 0%, 0.305) 93.2%,hsla(0, 0%, 0%, 0.377) 95.9%,hsla(0, 0%, 0%, 0.456) 97.7%,hsla(0, 0%, 0%, 0.543) 98.8%,hsla(0, 0%, 0%, 0.638) 99.5%,hsla(0, 0%, 0%, 0.74) 99.8%,hsla(0, 0%, 0%, 0.85) 100%),url("'+t.imgUrl+'") no-repeat center center',backgroundSize:"cover",display:"flex",flexDirection:"column",justifyContent:"space-between"}},o.a.createElement("div",null,o.a.createElement("p",{style:{color:"white"}},t.title)),o.a.createElement("div",{style:{position:"absoulte",bottom:"0"}},o.a.createElement("p",{style:{color:"#fff"}},t.num_comments),o.a.createElement("div",{dangerouslySetInnerHTML:t.comment,className:"top"})))}))))}}]),e}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(o.a.createElement(b,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[20,2,1]]]);
//# sourceMappingURL=main.13e5e204.chunk.js.map